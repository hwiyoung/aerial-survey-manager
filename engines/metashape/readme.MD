# Metashape Processing Engine

ν•­κ³µμΈ΅λ‰ λ§¤λ‹μ € ν”λ«νΌμ κ³ μ„±λ¥ μ •μ‚¬μμƒ μ²λ¦¬ μ—”μ§„μ…λ‹λ‹¤. Agisoft Metashape Professional Python SDKλ¥Ό κΈ°λ°μΌλ΅ λ™μ‘ν•©λ‹λ‹¤.

## π€ Key Features
- **GPU Acceleration**: NVIDIA CUDA κ°€μ†μ„ ν†µν• κ³ μ† λ§¤μΉ­ λ° ν¬μΈνΈ ν΄λΌμ°λ“ μƒμ„±
- **Celery Integration**: λ¶„μ‚° μ²λ¦¬ νλ¥Ό ν†µν• λΉ„λ™κΈ° μ‘μ—… κ΄€λ¦¬
- **License Persistence**: Docker λ³Όλ¥¨ λ° κ³ μ • MAC μ£Όμ†λ¥Ό ν™μ©ν• μ•μ •μ μΈ λΌμ΄μ„ μ¤ μ μ§€

## π›  Setup & Licensing

### 1. Environment Setup
`.env` νμΌμ— λΌμ΄μ„ μ¤ ν‚¤ λ° ν•λ“μ›¨μ–΄ μ„¤μ •μ„ μ…λ ¥ν•©λ‹λ‹¤.

```env
METASHAPE_LICENSE_KEY=XXXXX-XXXXX-XXXXX-XXXXX-XXXXX
```

### 2. License Activation
μ»¨ν…μ΄λ„ μ‹¤ν–‰ ν›„ μµμ΄ 1ν ν™μ„±ν™”κ°€ ν•„μ”ν•©λ‹λ‹¤.

```bash
# κ°λ° ν™κ²½ (.py)
docker exec aerial-worker-engine python3 /app/engines/metashape/dags/metashape/activate.py
# λ°°ν¬ ν™κ²½ (.pyc)
docker exec aerial-worker-engine python3 /app/engines/metashape/dags/metashape/activate.pyc
```

### 3. Verification
ν™μ„±ν™” μƒνƒλ¥Ό ν™•μΈν•λ ¤λ©΄ λ‹¤μ λ…λ Ήμ–΄λ¥Ό μ‹¤ν–‰ν•©λ‹λ‹¤.
```bash
docker exec aerial-worker-engine python3 -c "import Metashape; print(Metashape.License().valid)"
```

## π“ Structure
- `dags/`: Airflow νΈν™μ© DAG νμΌ (Celery Workerμ—μ„λ„ κ³µμ λ¨)
- `dags/metashape/`: μ‹¤μ  Metashape μ²λ¦¬ λ΅μ§ λ° κ³µν†µ μ ν‹Έλ¦¬ν‹°
- `Dockerfile`: κ°λ°μ© μ΄λ―Έμ§€ (CUDA 12.0 κΈ°λ°)
- `Dockerfile.prod`: λ°°ν¬μ© μ΄λ―Έμ§€ (.pyc μ»΄νμΌ, μ†μ¤ μ½”λ“ μ κ±°)

## π”’ μ½”λ“ λ³΄νΈ (λ°°ν¬ ν™κ²½)

λ°°ν¬ ν¨ν‚¤μ§€μ—μ„λ” Python μ†μ¤μ½”λ“κ°€ λ°”μ΄νΈμ½”λ“(.pyc)λ΅ μ»΄νμΌλμ–΄ λ³΄νΈλ©λ‹λ‹¤:

```bash
# λ°°ν¬ μ΄λ―Έμ§€ ν™•μΈ (.py νμΌ μ—†μ–΄μ•Ό ν•¨)
docker run --rm aerial-prod-worker-engine:latest \
  find /app/engines -name "*.py" -type f
# κ²°κ³Όκ°€ λΉ„μ–΄μμ–΄μ•Ό μ •μƒ
```

> λ°°ν¬ ν¨ν‚¤μ§€ λΉλ“: `./scripts/build-release.sh v1.0.x`

## β οΈ Notes
- Metashape 2.2.0 λ²„μ „μ„ μ‚¬μ©ν•λ©°, λΌμ΄μ„ μ¤ μ²΄ν¬ μ‹ `.valid` μ†μ„±μ„ μ‚¬μ©ν•©λ‹λ‹¤.
- λΌμ΄μ„ μ¤ νμΌμ€ `/var/tmp/agisoft/licensing` κ²½λ΅μ— μ €μ¥λλ„λ΅ μ„¤μ •λμ–΄ μμµλ‹λ‹¤.
- λ°°ν¬ ν™κ²½μ—μ„λ” `.pyc` ν™•μ¥μλ΅ μ¤ν¬λ¦½νΈλ¥Ό μ‹¤ν–‰ν•΄μ•Ό ν•©λ‹λ‹¤.
