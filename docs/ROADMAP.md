# 향후 개발 계획 (Roadmap)

> 📌 이 문서는 [README.md](../README.md)의 Implementation Roadmap과 연계된 상세 개발 계획입니다.

---

## 현재 진행 상황 (README Phase 기준)

| Phase | 상태 | 설명 |
|-------|------|------|
| Phase 1: Foundation | ✅ 완료 | 백엔드 구조, DB 스키마, JWT 인증 |
| Phase 2: Large File Transfer | ✅ 완료 | tus 업로드, Resumable 다운로드 |
| Phase 3: Processing Engine | ✅ 완료 | ODM 통합, 외부 엔진 API |
| Phase 4: Project Management | ✅ 완료 | EO 파싱, UI 최적화, 대시보드, 프리셋 |
| Phase 5: Advanced Features | ✅ 완료 | 권역 시각화 최적화, 통계, 내보내기, TiTiler 통합 |
| Phase 6: System Hardening | ✅ 완료 | TB 업로드, Monorepo 구조, 라이선스 안정화, Webhook |

---

## Phase 5.5 상세: 내보내기 및 시각화 고도화 (신규 2026-01-23)

### 5.5.1 ✅ 내보내기 기능 수정 (완료)
- [x] **일괄 내보내기 무결성**: ZIP 생성 옵션 수정 (`ZIP_DEFLATED`, `allowZip64`)으로 파일 손상 방지
- [x] **단일 프로젝트 직전 다운로드**: 단일 프로젝트의 경우 ZIP 압축 없이 `.tif` 파일로 직접 스트리밍
- [x] **파일명 커스터마이징**: 사용자가 지정한 파일명이 내보내기 결과물에 정확히 반영되도록 수정

- [x] **성능 최적화 (Canvas)**: Leaflet SVG 렌더러를 Canvas 렌더러로 전환 (`preferCanvas: true`)
- [x] **데이터 경량화 (Simplification)**: PostGIS `ST_SimplifyPreserveTopology(geom, 0.001)` 적용으로 GeoJSON 용량 70%+ 절감
- [x] **가시성 조정**: 비활성 권역 fillOpacity 0.03, weight 0.5로 대폭 낮추어 정사영상 시인성 확보
- [x] **상호작용 분리**: 권역 레이어 `interactive: false` 설정으로 정사영상 클릭 방해 요소 제거

---

## Phase 4 상세: UI/UX 개선

### 4.1 ✅ 완료된 항목

#### 기본 기능
- [x] EO 데이터 파싱 및 저장 (다중 공백 구분자 지원)
- [x] 지도에 촬영 위치 표시 (EPSG:5186 → WGS84 변환)
- [x] 프로젝트 삭제 (개별/멀티)
- [x] 업로드 완료 후 처리 화면 자동 진입
- [x] URL 파라미터를 통한 상태 유지

#### 대시보드 기능 (2026-01-08 완료)
- [x] **대시보드 레이아웃 토글**: Wide/Narrow/Auto 모드 선택 가능
  - 🔲 Wide: 지도와 통계를 가로로 배치
  - 📋 Narrow: 지도 아래에 통계 배치
  - 🔄 Auto: 컨테이너 너비에 따라 자동 전환
- [x] **처리 시작 후 하이라이트**: 처리 시작 시 대시보드로 이동하고 해당 프로젝트 풋프린트를 3.5초간 펄스 애니메이션으로 강조
- [x] **호버 액션 아이콘**: Compact 모드에서도 프로젝트 항목에 마우스 호버 시 처리(▶)/내보내기(⬇) 아이콘 표시
- [x] **확장된 프로젝트 정보**: InspectorPanel에 원본사진 수, 촬영일, 데이터용량 등 상세 정보 표시
- [x] **Footprint Map**: 프로젝트 영역을 지도에 폴리곤으로 표시 및 클릭 상호작용

#### 네비게이션 & 접근성
- [x] **메인 페이지 네비게이션**: 헤더 로고 클릭 시 메인 페이지로 이동
- [x] **처리 패널 접근성**: 프로젝트 카드에서 직접 처리 화면 접근 가능

---

### 4.2 ✅ 완료된 항목 (2026-01-09)

#### 4.2.1 사이드바 리사이즈 성능 개선
- [x] requestAnimationFrame 기반 throttling 적용
- [x] 리사이즈 중 애니메이션 최적화

#### 4.2.2 업로드 마법사 UX 개선
- [x] 취소/X 버튼 추가
- [x] 프로젝트 이름 지정 기능
- [x] 폴더 선택 시 이미지 파일만 필터링
- [x] 이미지/EO 수 불일치 경고 모달

#### 4.2.3 레이아웃 개선
- [x] Wide 모드 지도 전체 높이 사용
- [x] 사이드바 너비에 따른 자동 레이아웃 전환
- [x] 확장 모드 프로젝트 정보 가로 배치

---

### 4.3 ✅ 완료된 항목 (2026-01-10)

#### 4.3.1 처리 옵션 프리셋
- [x] 백엔드 프리셋 CRUD API 구현
- [x] 프론트엔드 프리셋 선택 및 자동 적용 로직
- [x] 현재 설정을 새 프리셋으로 저장 기능

#### 4.3.2 클릭/더블클릭 동작 분리
- [x] 단일 클릭: 프로젝트 선택 및 지도 하이라이트 (지도 껌뻑임 4회)
- [x] 더블 클릭: 상세 정보 패널(Inspector) 열기
- [x] 클릭 타이머를 통한 모호성 제거 (250ms 지연)

---

### 4.4 ✅ 완료된 항목 (2026-01-14)

#### 4.4.1 UI/UX 개선
- [x] 통계 하드코딩값(35%, 10건) 제거 → 실제 데이터 기반
- [x] 지역별 분포 차트 범례(Legend) 방식으로 변경 (레이블 잘림 수정)
- [x] 업로드 모달 ESC 키 닫기 기능
- [x] 처리 옵션 사이드바 뒤로가기(←) 버튼 추가

#### 4.4.2 지도 기능 개선
- [x] 프로젝트 선택 시 줌 유지 (줌 아웃 방지)
- [x] 하이라이팅 종료 후 색상 초기화
- [x] 싱글/더블 클릭 동작 완전 분리:
  - 싱글 클릭: FootprintMap + ProjectDetailView
  - 더블 클릭: FootprintMap + InspectorPanel (패널 교체)
- [x] 정사영상(COG) 오버레이: 선택/하이라이트 모두에서 표시

---

## Phase 5 상세: 고급 기능

> README의 Phase 5 항목과 연계

### 5.1 다중 사용자 권한 관리
- 조직 내 역할별 권한 분리 (관리자, 편집자, 뷰어)
- 프로젝트별 접근 권한 설정

### 5.2 조직 스토리지 할당량
- 조직별 MinIO 버킷 용량 제한
- 사용량 모니터링 및 알림

### 5.3 지도 시각화 고급 기능
- [x] Leaflet 기반 지도 컴포넌트
- [x] 촬영 위치 포인트 표시
- [x] 프로젝트 풋프린트 표시
- [x] 정사영상 오버레이 (COG 스트리밍 구현 완료, ✅ 2026-01-13 검증 완료)
- [x] **TiTiler 타일 서버 통합 (✅ 2026-01-22)**
  - 대용량 COG를 XYZ 타일로 효율적 스트리밍
  - 메모리 사용량 90%+ 절감 (257MB → 필요한 타일만)
- [x] 레이어 컨트롤 (토글 및 투명도 슬라이더 완료)
- [ ] **권역정보 표시 (향후 개발)**
  - 대시보드 지도에 행정구역/권역 경계 오버레이

### 5.4 대시보드 통계 확장 (✅ 완료 2026-01-12)
- [x] 프로젝트 현황 카드 (처리중/완료/전체)
- [x] 처리 면적 및 데이터 용량 통계
- [x] 월별 처리량 차트 (API 연동) - `/api/v1/projects/stats/monthly`
- [x] 지역별 분포 차트 (API 연동) - `/api/v1/projects/stats/regional`

### 5.5 일괄 내보내기
- 다중 프로젝트 정사영상 일괄 다운로드
- ZIP 압축 패키징

### 5.6 프로젝트 그루핑 (✅ 완료)
- [x] 백엔드 Group 모델 및 API 구현 (CRUD)
- [x] API 클라이언트 연동 및 Scaffolding (`GroupItem` 컴포넌트)
- [x] 사이드바 폴더 트리 렌더링 및 드래그앤드롭
- [x] 그룹 생성/수정/삭제 모달
- [x] 그룹별 필터링 (클릭으로 토글) ✅ 2026-01-19
- [ ] 그룹 단위 일괄 작업 (추후 개선)

---

## 최근 변경 이력

| 날짜 | 항목 | 내용 |
|------|------|------|
| 2026-01-19 | 업로드 최적화 | TUS 포트 불일치(1080/8080) 해결, Nginx 버퍼링 해제, 실시간 대시보드 및 병렬 전송 큐 도입 |
| 2026-01-19 | TB급 확장 계획 | 한 파일당 5TB 지원(`s3-part-size`), 브라우저 연결 안정성(`parallelUploads: 1`) 설계 반영 |
| 2026-01-19 | 버그 수정 | 통계 즉시 갱신, 위치 포인트 가시화 개선, Popup 레이아웃 완전 재설계 |
| 2026-01-19 | 그룹 필터링 | 그룹 클릭 시 해당 그룹 프로젝트만 표시 (토글 방식) |
| 2026-01-19 | 일괄 내보내기 | 다중 프로젝트 정사영상 ZIP 다운로드 API 및 UI 구현 |
| 2026-01-14 | UI/UX | 통계 하드코딩 제거, 차트 범례, ESC 닫기, 뒤로가기 버튼 |
| 2026-01-14 | 지도 | 줌 유지, 하이라이팅 초기화, 클릭 동작 분리, COG 개선 |
| 2026-01-13 | 정사영상 오버레이 | footprint-GeoTIFF 좌표 일치, proj4 Web Worker 호환성 해결, COG 파싱 완료 |
| 2026-01-13 | 통계 수정 | 하드코딩 fallback 값 제거, 실제 프로젝트 수 표시 |
| 2026-01-13 | API 수정 | Content-Disposition 한글 인코딩 오류 수정 (RFC 5987) |
| 2026-01-12 | COG 오버레이 | COG 스트리밍 레이어(`georaster`), 토글 버튼, 투명도 슬라이더 구현 완료 |
| 2026-01-12 | 통계 API | 월별/지역별 통계 API 엔드포인트 구현 및 대시보드 차트 연동 |
| 2026-01-12 | 그루핑 | 사이드바 폴더 트리, 드래그앤드롭, 생성/수정/삭제 모달 구현 완료 |
| 2026-01-10 | 그루핑 | 백엔드 API 및 프론트엔드 Scaffolding 완료 |
| 2026-01-10 | 프리셋 | 처리 옵션 프리셋 저장 및 불러오기 기능 |
| 2026-01-10 | UI/UX | 클릭/더블클릭 동작 분리 (상세보기 vs 하이라이트) |
| 2026-01-09 | 리사이즈 | RAF 기반 부드러운 사이드바 리사이즈 |
| 2026-01-09 | 업로드 | 취소 버튼, 프로젝트 이름, 이미지 필터링, 불일치 경고 |
| 2026-01-09 | 레이아웃 | Wide 지도 전체높이, 자동전환, 가로배치 |
| 2026-01-08 | 대시보드 | 레이아웃 토글 (Wide/Narrow/Auto) 추가 |
| 2026-01-08 | 대시보드 | 처리 시작 시 풋프린트 하이라이트 애니메이션 |
| 2026-01-08 | 프로젝트 | Compact 모드 호버 액션 아이콘 |
| 2026-01-08 | 프로젝트 | InspectorPanel에 확장 정보 표시 |
| 2026-01-07 | 프로젝트 | 삭제 기능 (개별/멀티) |
| 2026-01-07 | 지도 | EO 포인트 즉시 표시 수정 |

---

## 구현 권장 순서 (2026-01-12 확정)

### 1단계: 통계 API 연동 ✅ 완료
1. ~~**5.3/5.4 대시보드 통계 확장** - 월별/지역별 실제 API 데이터 연동~~ ✅

### 2단계: 지도 기능 (✅ 완료)
2. ~~**5.1 정사영상 오버레이** - COG 스트리밍 방식으로 구현~~ ✅
3. ~~**5.2 레이어 컨트롤** - 레이어 가시성 및 순서 제어~~ ✅
4. **5.7 그룹별 필터링** - 그룹 선택 시 프로젝트 필터링

### 3단계: 성능 최적화 (향후 개선사항)
5. **COG 로딩 성능 개선**
   - 현재 이슈: 프로젝트 클릭 후 정사영상 표시까지 4-5초 지연
   - 원인: Web Worker 비활성화 (`useWebWorker: false`), 전체 파일 다운로드
   - 개선 방안:
     - [ ] Web Worker 재활성화 (proj4 문제 해결)
     - [ ] COG 타일 스트리밍 (필요한 부분만 로드)
     - [ ] 로딩 인디케이터 추가 (UX 개선)
     - [ ] 클라이언트 캐싱 적용

### 후순위
6. **5.5 다중 사용자 권한 관리** - 필요시 추후 구현
7. **5.6 조직 스토리지 할당량** - 필요시 추후 구현

### 향후 개선 예정
8. **대시보드 권역정보 표시**
   - 행정구역/권역 경계 레이어 추가
   - 권역별 프로젝트 필터링
   - 권역별 통계 집계

9. **내보내기 기능 개선**
   - [ ] 내보내기 파일 가시화 문제 수정
   - [ ] 내보내기 파일명 변경 기능 수정

---

## 기술 스택 참조

- **프론트엔드**: React + Vite + TailwindCSS + Leaflet + Recharts
- **백엔드**: FastAPI + PostgreSQL + MinIO
- **업로드**: TUS Protocol (Resumable Upload)
- **처리 엔진**: OpenDroneMap + External API

---

---

## Phase 6: TB/PB-Scale Data Mobility (✅ 완료)

### 6.1 업로드 안정성 강화 ✅ 완료
- [x] **S3 파트 크기 최적화**: 500MB 파트 설정으로 단일 파일 5TB 지원
- [x] **연결 수 고정**: 브라우저 HTTP/1.1 소켓 고갈 방지를 위해 파일당 단일 스트림 강제
- [x] **자동 재개(Resumption)**: 네트워크 단절 시에도 브라우저 새로고침 없이 자동 재연결
- [x] **EO 데이터 파싱 고도화**: 대용량 CSV 파싱 속도 개선 및 500 에러 근본 해결

### 6.2 대용량 처리 파이프라인 ✅ 완료
- [x] **Monorepo 구조 도입**: `/engines` 하위로 ODM, Metashape 워커 소스 통합 관리
- [x] **Metashape GPU 워커**: 전용 Celery 큐 및 NVIDIA GPU 가속 엔진 연동 완료
- [x] **라이선스 안정화 전략**: Always Active + Volume Persistence로 중단 없는 연산 보장

### 6.3 🔧 처리 엔진 실제 통합 (✅ 완료)
- [x] **Docker Compose 서비스 활성화**
  - ODM 서비스 설정 및 메모리 제한 검증
  - Celery 워커 자동 재시작 설정
- [x] **실시간 처리 진행률 (WebSocket)**
  - ODM 로그 파싱하여 진행률 추출
  - WebSocket을 통한 프론트엔드 실시간 업데이트
- [x] **결과물 자동 파이프라인**
  - ODM 정사영상 → COG 변환 → MinIO 업로드
  - DB 상태 업데이트 및 프론트엔드 자동 새로고침

### 6.4 🎨 사이드 패널 UX 개선 ✅ 완료
- [x] **애니메이션 부드러움 개선**
  - ProcessingSidebar: cubic-bezier 슬라이드인/아웃 적용
  - InspectorPanel: 오른쪽 슬라이드 애니메이션 최적화
- [x] **리사이즈 성능 최적화**
  - GPU 가속 (will-change, transform) 적용
  - requestAnimationFrame 기반 스로틀링 고도화
  - 콘텐츠 리플로우 최소화 (60fps 보장)

---

## 최근 변경 이력 업데이트 (2026-01-22)

| 날짜 | 항목 | 내용 |
|------|------|------|
| 2026-01-27 | Metashape 통합 | Airflow 의존성 제거 및 Celery 워커 기반 통합 완료, 라이선스 자동 활성화 대응 |
| 2026-01-27 | 시스템 고도화 | TB급 업로드 최적화(20MB Chunk), Nginx 버퍼링 해제, Monorepo(/engines) 구조 도입 |
| 2026-01-27 | UX 애니메이션 | 사이드바/패널 하드웨어 가속(will-change) 및 cubic-bezier 애니메이션 적용 |
| 2026-01-27 | 권역 최적화 | ST_Simplify(0.001) 및 Canvas 렌더링 적용 완료, 상호작용 비활성화로 시인성 확보 |
| 2026-01-27 | External API | 기술 명세서 작성 완료, Webhook 엔드포인트 구현 및 드라이버 리팩토링 |
| 2026-01-23 | 내보내기 고도화 | 단일 TIF 직전 다운로드, ZIP 손상 수정, 파일명 커스텀 로직 보완 |

---

## ⚠️ Known Issues (2026-01-22)

### 내보내기 문제
- **해결됨**: 정사영상 파일 손상 및 파일명 변경 기능 수정 완료 (2026-01-23)

### 권역 시각화 성능 및 시인성
- **현상**: 권역 경계가 정사영상 영역을 가리고, 폴리곤 과다로 인한 지도 렌더링 지연 발생
- **해결**: Canvas 렌더링 전환 및 데이터 단순화(ST_Simplify) 진행 예정

### COG 로딩 문제
- **현상**: 지도에서 정사영상(COG)이 로드되지 않거나 타임아웃 발생
- **해결**: TiTiler 타일 서버 도입으로 대부분 해결됨 (2026-01-22)
- **남은 이슈**: MinIO presigned URL 외부 접근 시 `MINIO_PUBLIC_ENDPOINT` 설정 필요

### 향후 기능 요청
- 대시보드 지도에 권역정보 표시 필요 (진행 중)
- 그룹 단위 일괄 작업 기능

---

## Phase 7: System Maturity & Interactivity (현 계획)

### 7.1 지도-데이터 연동 고도화
- [ ] **권역별 연동 필터링**: 지도 권역 클릭 시 해당 지역 프로젝트 필터링 및 통계 자동 갱신
- [ ] **공간 검색**: 현재 보이는 지도 영역(BBox) 내 프로젝트 검색 기능
- [ ] **STAC 기반 메타데이터**: 결과물 STAC(SpatioTemporal Asset Catalog) 인덱싱 강화

### 7.2 일괄 작업 확장
- [ ] **그룹 일괄 처리**: 폴더 내 모든 대기 중인 프로젝트 일괄 처리 시작
- [ ] **그룹 일괄 내보내기**: 폴더 구조를 유지한 형태의 벌크 다운로드

### 7.3 프론트엔드 아키텍처 개선
- [ ] **App.jsx 컴포넌트 분리**: 거대 컴포넌트(2.7k lines)를 테마별/기능별로 모듈화
- [ ] **상태 관리 최적화**: Context API 및 불필요한 리렌더링 제거 (성능 향상)

## Phase 8: 협업 및 관리 (백로그)

### 8.1 다중 사용자 고도화
- [ ] 프로젝트 공유 및 협업 권한 (Share Link)
- [ ] 워크스페이스별 용량 제한 및 할당량 관리

---

*마지막 업데이트: 2026-01-28*

